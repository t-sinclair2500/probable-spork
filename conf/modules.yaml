# Module-specific configurations for the procedural animatics pipeline

# Video rendering and performance settings
render:
  resolution: "1920x1080"
  fps: 30
  music_db: -22
  duck_db: -15
  xfade_ms: 250
  target_bitrate: "4000k"
  codec: "h264_videotoolbox"  # Hardware acceleration
  preset: "fast"  # Encoding speed vs quality trade-off
  crf: 23  # Quality setting (18-28 range, lower = better quality)
  threads: 0  # Auto-detect optimal thread count
  use_hardware_acceleration: true  # Enable/disable hardware acceleration

# Music bed policy configuration
music:
  enabled: true                  # Enable/disable music bed functionality
  library_path: "assets/music"   # Path to music library
  auto_select: true              # Automatically select music based on content
  require_music: false           # Whether music is required for all videos
  fallback_to_silent: true      # Fallback to silent if no music available
  
  # Music selection criteria
  selection:
    bpm_weight: 0.4              # Weight for BPM matching (0.0-1.0)
    mood_weight: 0.4             # Weight for mood matching (0.0-1.0)
    genre_weight: 0.2            # Weight for genre matching (0.0-1.0)
    
  # Audio processing settings
  processing:
    enable_ducking: true         # Enable sidechain ducking
    enable_fades: true           # Enable fade in/out effects
    fade_in_ms: 500             # Fade-in duration in milliseconds
    fade_out_ms: 500            # Fade-out duration in milliseconds
    loop_strategy: "seamless"    # seamless, crossfade, or extend
    
  # Quality and licensing
  quality:
    min_bitrate: "128k"          # Minimum music bitrate
    preferred_formats: ["mp3", "wav", "m4a"]
    require_license_info: true   # Require license information for tracks

# Timing and duration policy settings
timing:
  target_tolerance_pct: 5         # acceptance +/- window vs brief target
  default_scene_ms: 5000          # only if no beats durations & no VO cues
  min_scene_ms: 2500              # minimum scene duration in milliseconds
  max_scene_ms: 30000             # maximum scene duration in milliseconds (30s for longer content)
  distribute_strategy: "weighted" # uniform|weighted (by words per beat)
  align_to_vo: true               # if srt/word timings exist, use them

# Animatics pipeline settings
animatics:
  enabled: true
  max_words_per_card: 12  # Maximum words per text element for legibility
  safe_margins_px: 80  # Safe margin from edges for text elements

# Micro-animations settings
micro_anim:
  enable: true                    # Enable/disable micro-animations
  max_elements_percent: 10        # Maximum percentage of elements to animate (≤10%)
  max_movement_px: 4              # Maximum movement amplitude in pixels (≤4px)
  max_movement_per_1000ms: 4      # Maximum movement per 1000ms
  ease_in_out: true               # Use ease-in/ease-out timing
  seed: 42                        # Seed for deterministic animations
  collision_check: true            # Re-check collisions after animation
  log_level: "info"               # Logging level for micro-animations

# Procedural generation settings
procedural:
  seed: 42  # Default seed for deterministic layouts (set to null for random)
  enable_jitter: true  # Allow slight position variations for natural feel
  jitter_range: 8  # Maximum pixel jitter when enabled
  max_colors_per_scene: 3  # Maximum colors allowed per scene for brand consistency
  placement:
    min_spacing_px: 64
    safe_margin_px: 40
  motion:
    jitter_ms: 80
  layout:
    strategy: "auto"        # auto|text_only|props_only|manual
    prefer_thirds: true
    max_attempts: 200

# Layout engine settings
layout:
  poisson:
    k_attempts: 30  # Maximum attempts for Poisson-disk sampling
    min_spacing: 64  # Minimum distance between points (pixels)
  packing:
    algorithm: "skyline"  # skyline | rectpack | simulated_annealing
    max_iterations: 1000  # Maximum iterations for overlap resolution
    overlap_penalty: 1000  # Penalty weight for overlapping elements
  constraints:
    safe_margin_default: 64  # Default safe margin from edges
    thirds_snap_tolerance: 16  # Pixels within which to snap to rule-of-thirds

# Asset management and validation settings
assets:
  reuse_ratio_threshold: 0.7  # Minimum reuse ratio when library has >50 assets
  enable_palette_validation: true  # Enable strict palette compliance checking
  enable_provenance_tracking: true  # Track generation parameters and seeds
  max_generated_assets_per_run: 20  # Maximum new assets generated per pipeline run

# Pacing analysis and feedback settings
pacing:
  enable: true                    # Enable/disable pacing analysis and feedback
  strict: false                   # Strict mode: FAIL on out-of-band metrics
  max_adjust_ms_per_scene: 1000  # Maximum adjustment per scene in milliseconds
  max_total_adjust_ms: 5000      # Maximum total adjustment across all scenes
  tolerance_pct: 10              # Percentage tolerance for "ok" vs "fast/slow"
  require_kpis: true             # Require KPI presence for acceptance PASS

# Geometry engine settings
geometry:
  enable: false                   # Enable/disable SVG geometry operations
  validate_paths: true            # Validate SVG paths for self-intersections
  max_complexity: 1000           # Maximum path complexity (segments)
  fallback_on_error: true        # Fallback to passthrough on geometry errors
  library_versions:               # Track library versions for validation
    shapely: "auto"              # Auto-detect or specify version
    svgpathtools: "auto"         # Auto-detect or specify version
